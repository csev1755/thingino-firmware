#!/bin/sh

. /etc/init.d/rc.common

config_file=/etc/webui/zerotier.conf
[ -f "$config_file" ] && . $config_file

case "$1" in
	start)
		[ "false" = "$zerotier_enabled" ] && die 3 "Zerotier-One service is disabled in $config_file"

		starting
		{ modprobe tun && zerotier-one -d } || die 1 "FAIL"
		echo "OK"
		;;
	stop)
		stopping
		{ kill -9 $(pidof zerotier-one) && rmmod -w tun } || die 1 "FAIL"
		echo "OK"
		;;
	*)
		die 1 "Usage: $0 {start|stop}"
		;;
esac
