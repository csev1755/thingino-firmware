#!/bin/sh

. /etc/init.d/rc.common

case "$1" in
	start)
		HOSTNAME=$(fw_printenv -n hostname 2> /dev/null)
		if [ -z "$HOSTNAME" ]; then
			OS_NAME=$(sed -n 's/^HOSTNAME=//p' /etc/os-release)
			MAC_SUFFIX=$(fw_printenv -n wlanmac | sed 's/://g;s/.*\(....\)$/\1/')
			HOSTNAME="${OS_NAME}-${MAC_SUFFIX}"
		fi
		starting
		hostname "$HOSTNAME" || die 1 "FAIL"
		echo "OK"
		sed -i "/^127.0.1.1/s/\t.*$/\t$HOSTNAME/" /etc/hosts
		;;
	stop)
		true
		;;
	*)
		die 1 "Usage: $0 {start}"
		;;
esac

exit 0
